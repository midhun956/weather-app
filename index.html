<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modern Weather App</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Lucide icons -->
    <script src="https://unpkg.com/lucide-react@latest/dist/umd/lucide.min.js"></script>
    
    <style>
        /* Custom font */
        body {
            font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }

        /* Glassmorphism effect */
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Animation for results */
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Custom scrollbar for forecast */
        .forecast-scroll::-webkit-scrollbar {
            height: 6px;
        }
        .forecast-scroll::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }
        .forecast-scroll::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 10px;
        }
        .forecast-scroll::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.5);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-900 via-purple-900 to-indigo-900 min-h-screen text-white p-4 sm:p-8 flex justify-center items-center">

    <div class="w-full max-w-4xl mx-auto">
        
        <!-- Main Container -->
        <div class="glass-card rounded-2xl shadow-2xl p-6 md:p-8">
            
            <!-- Header and Search -->
            <div class="flex flex-col sm:flex-row justify-between items-center gap-4 mb-6">
                <h1 class="text-3xl font-bold">Weather App</h1>
                <div class="w-full sm:w-auto flex gap-2">
                    <input type="text" id="cityInput" placeholder="Enter city name" class="w-full sm:w-64 bg-white/20 text-white placeholder-white/70 rounded-lg px-4 py-2 border-none focus:outline-none focus:ring-2 focus:ring-blue-400 transition-all duration-300">
                    <button id="getWeather" class="bg-blue-500 hover:bg-blue-600 rounded-lg px-4 py-2 font-semibold shadow-lg transition-all duration-300 transform hover:scale-105">
                        Search
                    </button>
                    <button id="getLocation" class="bg-gray-500 hover:bg-gray-600 rounded-lg p-2.5 font-semibold shadow-lg transition-all duration-300 transform hover:scale-105" title="Get weather for my location">
                        <!-- Location Icon -->
                        <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"></path></svg>
                    </button>
                </div>
            </div>

            <!-- Loading Spinner -->
            <div id="loader" class="text-center py-10 hidden">
                <div class="inline-block w-12 h-12 border-4 border-white/30 border-t-white rounded-full animate-spin"></div>
                <p class="mt-4 text-lg">Fetching weather...</p>
            </div>

            <!-- Error Message -->
            <div id="errorDisplay" class="text-center py-10 bg-red-500/20 text-red-300 rounded-lg hidden fade-in">
                <p id="errorMessage" class="text-lg font-medium"></p>
            </div>

            <!-- Weather Results Container -->
            <div id="weatherContainer" class="hidden">

                <!-- Current Weather Section -->
                <div id="currentWeather" class="text-center mb-8 fade-in">
                    <!-- This content will be generated by JavaScript -->
                </div>

                <!-- 5-Day Forecast Section -->
                <div id="forecast" class="fade-in">
                    <h2 class="text-2xl font-semibold mb-4 text-center sm:text-left">5-Day Forecast</h2>
                    <div id="forecastContainer" class="flex overflow-x-auto gap-4 pb-4 forecast-scroll">
                        <!-- This content will be generated by JavaScript -->
                    </div>
                </div>

            </div>

        </div>
    </div>

    <script>
        // Your original API key
        const apiKey = 'f8f4160768dd0be1b96fcd82afa8737b';
        
        // DOM Elements
        const cityInput = document.getElementById('cityInput');
        const getWeatherBtn = document.getElementById('getWeather');
        const getLocationBtn = document.getElementById('getLocation');
        const loader = document.getElementById('loader');
        const errorDisplay = document.getElementById('errorDisplay');
        const errorMessage = document.getElementById('errorMessage');
        const weatherContainer = document.getElementById('weatherContainer');
        const currentWeatherDiv = document.getElementById('currentWeather');
        const forecastContainer = document.getElementById('forecastContainer');

        // Weather Icon mapping
        const weatherIcons = {
            "Clear": `<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>`, // Sun
            "Clouds": `<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path></svg>`, // Cloud
            "Rain": `<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path><path d="M16 16v1m-8-1v1m4-1v1"></path></svg>`, // Cloud Rain
            "Drizzle": `<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path><path d="M16 16v.01m-8-.01v.01m4-.01v.01"></path></svg>`, // Cloud Drizzle
            "Snow": `<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 10h-1.26A8 8 0 1 0 9 20h9a5 5 0 0 0 0-10z"></path><path d="M16 16v.01m-8-.01v.01m4-.01v.01m-4-4v.01m4-.01v.01m4-.01v.01"></path></svg>`, // Cloud Snow
            "Thunderstorm": `<svg xmlns="http://www.w3.org/2L2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path><polyline points="7.5 4.21 12 6.81 16.5 4.21"></polyline><polyline points="16.5 19.79 12 17.19 7.5 19.79"></polyline><polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline><line x1="12" y1="22.08" x2="12" y2="12"></line></svg>`, // Cloud Lightning
            "Mist": `<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12c0-1.66 4-3 7-3s7 1.34 7 3c0 1.66-4 3-7 3s-7-1.34-7-3z"></path><path d="M5 15c0-1.66 4-3 7-3s7 1.34 7 3c0 1.66-4 3-7 3s-7-1.34-7-3z"></path><path d="M5 18c0-1.66 4-3 7-3s7 1.34 7 3c0 1.66-4 3-7 3s-7-1.34-7-3z"></path></svg>`, // Mist
            "Fog": `<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12c0-1.66 4-3 7-3s7 1.34 7 3c0 1.66-4 3-7 3s-7-1.34-7-3z"></path><path d="M5 15c0-1.66 4-3 7-3s7 1.34 7 3c0 1.66-4 3-7 3s-7-1.34-7-3z"></path><path d="M5 18c0-1.66 4-3 7-3s7 1.34 7 3c0 1.66-4 3-7 3s-7-1.34-7-3z"></path></svg>`, // Fog
            "Haze": `<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12c0-1.66 4-3 7-3s7 1.34 7 3c0 1.66-4 3-7 3s-7-1.34-7-3z"></path><path d="M5 15c0-1.66 4-3 7-3s7 1.34 7 3c0 1.66-4 3-7 3s-7-1.34-7-3z"></path></svg>`, // Haze
            "default": `<svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg>` // Default Icon
        };

        // Event Listeners
        getWeatherBtn.addEventListener('click', () => {
            const city = cityInput.value.trim();
            if (city) {
                fetchWeather(city);
            } else {
                showError("Please enter a city name.");
            }
        });

        cityInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                getWeatherBtn.click();
            }
        });

        // FIXED: Removed the underscore causing the syntax error
        getLocationBtn.addEventListener('click', () => {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                    const { latitude, longitude } = position.coords;
                    fetchWeatherByCoords(latitude, longitude);
                }, () => {
                    showError("Unable to retrieve location. Please allow location access.");
                });
            } else {
                showError("Geolocation is not supported by your browser.");
            }
        });

        // Show/Hide UI functions
        function showLoader() {
            loader.classList.remove('hidden');
            weatherContainer.classList.add('hidden');
            errorDisplay.classList.add('hidden');
        }

        function hideLoader() {
            loader.classList.add('hidden');
        }

        function showError(message) {
            hideLoader();
            errorMessage.textContent = message;
            errorDisplay.classList.remove('hidden');
            weatherContainer.classList.add('hidden');
        }

        function showWeather() {
            hideLoader();
            errorDisplay.classList.add('hidden');
            weatherContainer.classList.remove('hidden');
        }

        // Fetch Weather from API
        async function fetchWeather(city) {
            showLoader();
            try {
                // Fetch current weather
                const weatherResponse = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric`);
                if (!weatherResponse.ok) {
                    throw new Error(`City not found (Error ${weatherResponse.status})`);
                }
                const weatherData = await weatherResponse.json();

                // Fetch 5-day forecast
                const forecastResponse = await fetch(`https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${apiKey}&units=metric`);
                if (!forecastResponse.ok) {
                    throw new Error(`Forecast not found (Error ${forecastResponse.status})`);
                }
                const forecastData = await forecastResponse.json();

                // Display data
                displayCurrentWeather(weatherData);
                displayForecast(forecastData);
                showWeather();

                // Save last city to localStorage
                localStorage.setItem('lastWeatherCity', city);

            } catch (error) {
                showError(error.message);
            }
        }
        
        // Fetch Weather by Coords
        async function fetchWeatherByCoords(lat, lon) {
            showLoader();
            try {
                // Fetch current weather
                const weatherResponse = await fetch(`https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric`);
                if (!weatherResponse.ok) {
                    throw new Error(`Weather not found for your location (Error ${weatherResponse.status})`);
                }
                const weatherData = await weatherResponse.json();

                // Fetch 5-day forecast
                const forecastResponse = await fetch(`https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric`);
                if (!forecastResponse.ok) {
                    throw new Error(`Forecast not found for your location (Error ${forecastResponse.status})`);
                }
                const forecastData = await forecastResponse.json();

                // Display data
                displayCurrentWeather(weatherData);
                displayForecast(forecastData);
                showWeather();

                // Save last city to localStorage
                localStorage.setItem('lastWeatherCity', weatherData.name);
                cityInput.value = weatherData.name;


            } catch (error) {
                showError(error.message);
            }
        }


        // Display Current Weather
        function displayCurrentWeather(data) {
            const { name, sys, main, weather, wind, dt } = data;
            const weatherMain = weather[0].main;
            const weatherDesc = weather[0].description;
            const icon = weatherIcons[weatherMain] || weatherIcons['default'];

            const currentDate = new Date(dt * 1000).toLocaleDateString('en-US', {
                weekday: 'long',
                month: 'long',
                day: 'numeric'
            });

            currentWeatherDiv.innerHTML = `
                <h2 class="text-4xl font-bold mb-2">${name}, ${sys.country}</h2>
                <p class="text-lg text-white/80 mb-6">${currentDate}</p>
                <div class="flex flex-col md:flex-row items-center justify-center gap-6 md:gap-12">
                    <div class="flex items-center">
                        <span class="inline-block w-20 h-20">${icon}</span>
                        <div class="ml-4 text-left">
                            <p class="text-6xl font-bold">${Math.round(main.temp)}°C</p>
                            <p class="text-xl capitalize text-white/80">${weatherDesc}</p>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-x-8 gap-y-4 text-left text-lg">
                        <p class="text-white/80">Feels like: <span class="font-semibold text-white">${Math.round(main.feels_like)}°C</span></p>
                        <p class="text-white/80">Humidity: <span class="font-semibold text-white">${main.humidity}%</span></p>
                        <p class="text-white/80">Min/Max: <span class="font-semibold text-white">${Math.round(main.temp_min)}°/${Math.round(main.temp_max)}°</span></p>
                        <p class="text-white/80">Wind: <span class="font-semibold text-white">${wind.speed} m/s</span></p>
                    </div>
                </div>
            `;
        }

        // Display 5-Day Forecast
        function displayForecast(data) {
            forecastContainer.innerHTML = '';
            
            // Get forecast for the next 5 days (one entry per day, around midday)
            const dailyForecasts = data.list.filter(item => {
                return item.dt_txt.includes("12:00:00");
            });

            // If no 12:00:00 data (e.g., API changed), create a simple daily list
            if (dailyForecasts.length === 0) {
                let processedDays = [];
                for (const item of data.list) {
                    const day = new Date(item.dt * 1000).toLocaleDateString('en-US', { weekday: 'short' });
                    if (!processedDays.includes(day)) {
                        dailyForecasts.push(item);
                        processedDays.push(day);
                    }
                    if (dailyForecasts.length >= 5) break;
                }
            }

            dailyForecasts.slice(0, 5).forEach(item => {
                const { main, weather, dt } = item;
                const weatherMain = weather[0].main;
                const icon = weatherIcons[weatherMain] || weatherIcons['default'];

                const day = new Date(dt * 1000).toLocaleDateString('en-US', { weekday: 'short' });

                const forecastCard = `
                    <div class="glass-card flex-shrink-0 w-36 text-center rounded-xl p-4">
                        <p class="text-lg font-semibold mb-1">${day}</p>
                        <span class="inline-block w-16 h-16 opacity-90">${icon}</span>
                        <p class="text-2xl font-bold mt-1">${Math.round(main.temp)}°C</p>
                        <p class="text-sm text-white/70">${weatherMain}</p>
                    </div>
                `;
                forecastContainer.innerHTML += forecastCard;
            });
        }
        
        // On Load: Get location or load last city
        document.addEventListener('DOMContentLoaded', () => {
            const lastCity = localStorage.getItem('lastWeatherCity');
            if (lastCity) {
                cityInput.value = lastCity;
                fetchWeather(lastCity);
            } else {
                // If no last city, try to get user's location
                getLocationBtn.click();
            }
        });

    </script>
</body>
</html>

